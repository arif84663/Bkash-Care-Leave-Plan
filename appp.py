import streamlit as st
import pandas as pd
from datetime import date

# рзз. ржЖржкржирж╛рж░ ржЧрзБржЧрж▓ рж╢рж┐ржЯрзЗрж░ рж▓рж┐ржЩрзНржХржЯрж┐ ржПржЦрж╛ржирзЗ ржжрж┐ржи (Share > Anyone with link > Copy link)
# рж▓рж┐ржЩрзНржХржЯрж┐рж░ рж╢рзЗрж╖рзЗ '/edit...' ржЕржВрж╢ржЯрзБржХрзБ ржорзБржЫрзЗ ржжрж┐ржпрж╝рзЗ '/export?format=csv' ржмрж╕рж╛рждрзЗ рж╣ржмрзЗ
SHEET_URL = "https://docs.google.com/spreadsheets/d/1-40K82AnuKMeNExSA4lGA7n9GEAusDef_Icr9S9LW6g/edit?usp=drivesdk"

st.set_page_config(page_title="Office Leave App", layout="centered")

# ржЧрзБржЧрж▓ рж╢рж┐ржЯ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
def get_employee_data():
    try:
        df = pd.read_csv(SHEET_URL)
        return df
    except:
        st.error("ржЧрзБржЧрж▓ рж╢рж┐ржЯ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржЪрзНржЫрзЗ ржирж╛ред рж▓рж┐ржЩрзНржХржЯрж┐ ржЪрзЗржХ ржХрж░рзБржиред")
        return pd.DataFrame()

st.title("ЁЯТ╝ рж╕рзНржорж╛рж░рзНржЯ ржЕржлрж┐рж╕ рж▓рж┐ржн рж╕рж┐рж╕рзНржЯрзЗржо")

menu = ["ЁЯПа рж╣рзЛржо", "ЁЯУЭ ржЫрзБржЯрж┐рж░ ржЖржмрзЗржжржи", "ЁЯУК ржЕрзНржпрж╛ржбржорж┐ржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб"]
choice = st.sidebar.selectbox("ржорзЗржирзБ", menu)

df_emp = get_employee_data()

if choice == "ЁЯПа рж╣рзЛржо":
    st.subheader("рж╕рзНржмрж╛ржЧрждржо!")
    st.info("ржЖржкржирж╛рж░ ржПржоржкрзНрж▓ржпрж╝рзА ржЖржЗржбрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЫрзБржЯрж┐рж░ ржЖржмрзЗржжржи ржХрж░рзБржиред")
    if not df_emp.empty:
        st.write("ржмрж░рзНрждржорж╛ржи ржПржоржкрзНрж▓ржпрж╝рзА рждрж╛рж▓рж┐ржХрж╛:")
        st.dataframe(df_emp[['ID', 'Name', 'Post']])

elif choice == "ЁЯУЭ ржЫрзБржЯрж┐рж░ ржЖржмрзЗржжржи":
    st.subheader("ржЖржмрзЗржжржи ржлрж░ржо ржкрзВрж░ржг ржХрж░рзБржи")
    with st.form("leave_form"):
        user_id = st.text_input("ржЖржкржирж╛рж░ ржПржоржкрзНрж▓ржпрж╝рзА ржЖржЗржбрж┐ (ржпрзЗржоржи: 101)")
        leave_type = st.selectbox("ржЫрзБржЯрж┐рж░ ржзрж░ржи", ["ржЕрж╕рзБрж╕рзНржерждрж╛", "ржмрзНржпржХрзНрждрж┐ржЧржд", "ржЬрж░рзБрж░рзА"])
        s_date = st.date_input("рж╢рзБрж░рзБрж░ рждрж╛рж░рж┐ржЦ")
        e_date = st.date_input("рж╢рзЗрж╖рзЗрж░ рждрж╛рж░рж┐ржЦ")
        reason = st.text_area("ржХрж╛рж░ржг рж▓рж┐ржЦрзБржи")
        
        if st.form_submit_button("ржЖржмрзЗржжржи ржЬржорж╛ ржжрж┐ржи"):
            # ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржЖржЗржбрж┐ржЯрж┐ рж╢рж┐ржЯрзЗ ржЖржЫрзЗ ржХрж┐ ржирж╛
            if str(user_id) in df_emp['ID'].astype(str).values:
                # ржПржЦрж╛ржирзЗ ржЖржкрж╛рждржд ржЖржорж░рж╛ рж╕рзЗрж╢ржи рж╕рзНржЯрзЗржЯрзЗ рж░рж╛ржЦржЫрж┐, ржкрж░рзЗ рж╢рж┐ржЯрзЗ рж╕рзЗржн ржХрж░рж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржо ржХрж░рж╛ ржпрж╛ржмрзЗ
                st.success(f"ржзржирзНржпржмрж╛ржж {user_id}, ржЖржкржирж╛рж░ ржЖржмрзЗржжржиржЯрж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ!")
            else:
                st.error("ржжрзБржГржЦрж┐ржд, ржПржЗ ржЖржЗржбрж┐ржЯрж┐ ржЖржорж╛ржжрзЗрж░ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржирзЗржЗред")

elif choice == "ЁЯУК ржЕрзНржпрж╛ржбржорж┐ржи ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб":
    st.subheader("ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓")
    password = st.text_input("ржЕрзНржпрж╛ржбржорж┐ржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи", type="password")
    if password == "admin123": # ржЖржкржирж╛рж░ ржкржЫржирзНржжрзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи
        st.write("рж╕ржм ржПржоржкрзНрж▓ржпрж╝рзАрж░ рждржерзНржп (ржЧрзБржЧрж▓ рж╢рж┐ржЯ ржерзЗржХрзЗ рж╕рж░рж╛рж╕рж░рж┐):")
        st.table(df_emp)
    elif password:
        st.error("ржнрзБрж▓ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб!")
